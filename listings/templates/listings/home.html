<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>iRent ProSpace – Find Your Dream Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  {% load static %}
  <link rel="stylesheet" href="{% static 'listings/style.css' %}">
  <style>
    .hero { background: #fff; padding: 3rem 0 2rem; }
    .search-bar { background: #ffffff; border: 1px solid #e6e6e6; border-radius: 12px; padding: 1.25rem; box-shadow: 0 4px 16px rgba(0,0,0,.04); }
    .price-pill { display: inline-block; border: 1px solid #d0d0d0; border-radius: 20px; padding: .35rem .9rem; margin: .25rem; font-size: .8rem; cursor: pointer; transition: all .2s; }
    .price-pill:hover, .price-pill.active { background: #000; color: #fff; border-color: #000; }
    .chip { display: inline-block; border: 1px solid #d0d0d0; border-radius: 18px; padding: .3rem .8rem; margin: .2rem; font-size: .75rem; cursor: pointer; transition: all .2s; }
    .chip:hover, .chip.active { background: #000; color: #fff; border-color: #000; }
    .results-scroll { min-height: 100vh; }
  </style>
</head>
<body>
  <!-- MINIMAL HEADER -->
<nav class="navbar navbar-custom sticky-top">
  <div class="container d-flex justify-content-between align-items-center">
    <a class="navbar-brand fw-700" href="{% url 'home' %}" style="letter-spacing:-.5px;">iRent ProSpace</a>
    <div class="d-flex gap-2">
      <a class="btn btn-sm" href="{% url 'about' %}">About</a>
      <a class="btn btn-sm" href="{% url 'contact' %}">Contact</a>
      {% if user.is_authenticated %}
        <a class="btn btn-sm btn-accent" href="{% url 'my_properties' %}">My Properties</a>
        <a class="btn btn-sm btn-accent" href="{% url 'landlord_upload' %}">Add Property</a>
        <a class="btn btn-sm" href="{% url 'logout' %}">Logout</a>
      {% else %}
        <a class="btn btn-sm" href="{% url 'signup' %}">Sign Up</a>
      {% endif %}
    </div>
  </div>
</nav>

<!-- HERO -->
<section class="hero">
  <div class="container text-center">
    <h1 class="fw-700 mb-3">Find what fits you</h1>

    <!-- SEARCH WRAPPER – taller -->
    <form method="get" class="search-bar">
      <!-- Row 1: Location + Bedrooms + Price -->
      <div class="row g-3 mb-4">
        <div class="col-md-4">
          <input class="form-control form-control-lg" type="text" name="location" placeholder="Search by location" value="{{ request.GET.location }}">
        </div>
        <div class="col-md-3">
          <select class="form-select form-select-lg" name="bedrooms">
            {% for val, label in bedroom_choices %}
              <option value="{{ val }}" {% if request.GET.bedrooms == val %}selected{% elif not request.GET.bedrooms and val == 'Single Room' %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-3">
          <input class="form-control form-control-lg" type="number" name="price" placeholder="Price (KES)" min="0" value="{{ request.GET.price }}">
        </div>
        <!-- Empty column so Search button sits on next row -->
      </div>

      <!-- Row 2: Price Pills -->
      <div class="mb-4">
        <small class="text-muted me-3">Filter by budget:</small>
        <span class="price-pill" data-val="1-5k">KES 1 – 5 k</span>
        <span class="price-pill" data-val="5-10k">KES 5 – 10 k</span>
        <span class="price-pill" data-val="10-20k">KES 10 – 20 k</span>
        <span class="price-pill" data-val="20k+">KES 20 k+</span>
      </div>

      <!-- Row 3: Bedroom Chips -->
      <div class="mb-4">
        <small class="text-muted me-3">Preferred bedrooms:</small>
        {% for val, label in bedroom_choices %}
          <span class="chip" data-bed="{{ val }}">{{ label }}</span>
        {% endfor %}
      </div>

      <!-- Row 4: Search Button (bottom) -->
      <div class="d-flex justify-content-center">
        <button class="btn btn-accent btn-lg px-5">Search</button>
      </div>
    </form>
  </div>
</section>

<!-- RESULTS (infinite scroll area) -->
<section class="results-scroll py-5">
  <div class="container">
    <div class="row g-4">
      {% for prop in properties %}
        <div class="col-md-4">
          <div class="card h-100 shadow-sm">
            {% if prop.images.first %}
              <img src="{{ prop.images.first.image.url }}" class="card-img-top" alt="{{ prop.title }}">
            {% else %}
              <div class="bg-light text-center py-5 text-muted">No Image</div>
            {% endif %}
            <div class="card-body">
              <h6 class="card-title fw-600">{{ prop.title }}</h6>
              <p class="card-text text-muted small mb-2">
                {{ prop.location }} • KES {{ prop.price }} • {{ prop.bedrooms }}
              </p>
              <a href="{% url 'property_detail' prop.id %}" class="btn btn-sm btn-accent">View Details</a>
            </div>
          </div>
        </div>
      {% empty %}
        <div class="col-12 text-center py-5">
          <p class="text-muted">No properties match your filters — scroll for more or adjust search.</p>
        </div>
      {% endfor %}
    </div>
  </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
/* sync pills/chips with form fields */
document.querySelectorAll('.price-pill').forEach(p => {
  p.addEventListener('click', () => {
    document.querySelector('input[name="price"]').value = '';
    document.querySelector('select[name="price_range"]').value = p.dataset.val;
    p.form.submit();
  });
});
document.querySelectorAll('.chip').forEach(c => {
  c.addEventListener('click', () => {
    document.querySelector('select[name="bedrooms"]').value = c.dataset.bed;
    c.form.submit();
  });
});
</script>
</body>
</html>