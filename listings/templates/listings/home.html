<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>iRent ProSpace – Find Your Dream Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  {% load static %}
  <link rel="stylesheet" href="{% static 'listings/style.css' %}">
  <style>
    .hero { background: #fff; padding: 3rem 0 2rem; }
    .search-bar { background: #ffffff; border: 1px solid #e6e6e6; border-radius: 12px; padding: 1.25rem; box-shadow: 0 4px 16px rgba(0,0,0,.04); }
    .price-pill { display: inline-block; border: 1px solid #d0d0d0; border-radius: 20px; padding: .35rem .9rem; margin: .25rem; font-size: .8rem; cursor: pointer; transition: all .2s; }
    .price-pill:hover, .price-pill.active { background: #000; color: #fff; border-color: #000; }
    .chip { display: inline-block; border: 1px solid #d0d0d0; border-radius: 18px; padding: .3rem .8rem; margin: .2rem; font-size: .75rem; cursor: pointer; transition: all .2s; }
    .chip:hover, .chip.active { background: #000; color: #fff; border-color: #000; }
    .results-scroll { min-height: 100vh; }
  </style>
</head>
<body>
<!-- MINIMAL HEADER -->
<nav class="navbar navbar-custom">
  <div class="container d-flex justify-content-between align-items-center">
    <div class="d-flex align-items-center gap-2">
      <a class="navbar-brand fw-700" href="{% url 'home' %}">iRent ProSpace</a>
      {% if user.is_authenticated %}
        <span class="navbar-text fw-600">Hi {{ user.username }}!</span>
      {% endif %}
    </div>
    <div class="d-flex gap-2">
      <a class="btn btn-sm" href="{% url 'about' %}">About</a>
      <a class="btn btn-sm" href="{% url 'contact' %}">Contact Us</a>
      {% if user.is_authenticated %}
        {% if user.profile.user_type == 'landlord' %}
          <a class="btn btn-sm btn-accent" href="{% url 'my_properties' %}">My Properties</a>
          <a class="btn btn-sm btn-accent" href="{% url 'landlord_upload' %}">Add Property</a>
        {% endif %}
        <a class="btn btn-sm" href="{% url 'logout' %}">Logout</a>
      {% else %}
        <a class="btn btn-sm" href="{% url 'signup' %}">Sign Up</a>
        <a class="btn btn-sm" href="{% url 'user_login' %}">Log In</a>
      {% endif %}
    </div>
  </div>
</nav>

<!-- HERO (tenants / anonymous only) -->
{% if not is_landlord %}
<!-- Google Inter font -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<section class="hero" style="font-family: 'Inter', sans-serif; padding-top: 4rem;">
  <div class="container text-center">

    <!-- Exact screenshot headline -->
    
<!-- 7 rem lighter exact-screenshot headline -->
<h2 style="margin: 0; font-size: 7rem; font-weight: 400; letter-spacing: -0.04em; line-height: 1;">Find Your Perfect</h2>
<h2 style="margin: 0; font-size: 7rem; font-weight: 400; letter-spacing: -0.04em; line-height: 1;">Rental-Where</h2>
<h2 style="margin: 0 0 0.5rem 0; font-size: 7rem; font-weight: 300; letter-spacing: -0.04em; line-height: 1;">Dreams Meet Reality</h2>

 <div style="height: 1.2rem; background: transparent;"></div>

    <!-- Smooth separator line -->
    <hr class="mb-4" style="width: 80px; margin: 0 auto; border-top: 2px solid #e5e5e5;">

    <!-- Big “Find what fits you” -->
    <h1 class="fw-700 mb-5" style="font-size: 4rem; letter-spacing: -1px;">Find what fits you</h1>

    <!-- DUAL-BUTTON ROW -->
    <div class="d-flex justify-content-center gap-3 mb-5">
      <!-- Button 1: Dream Home (no filters) -->
      <a href="?show=all" class="btn btn-outline-dark btn-lg px-4">Find your dream home</a>
      <!-- Button 2: Scroll to criteria -->
      <button class="btn btn-accent btn-lg px-4" onclick="document.querySelector('.search-bar').scrollIntoView({behavior:'smooth'})">Choose criteria</button>
    </div>

    <!-- FULL-WIDTH FILTER PAD -->
    <form method="get" class="search-bar" style="padding: 3rem 1.5rem; max-width: 100%;" onsubmit="scrollToResults()">
      <!-- Row 1: Location + Bedrooms + Price (smaller boxes) -->
      <div class="row g-3 mb-4 justify-content-center">
        <div class="col-md-3">
          <input id="location-input"
                 class="form-control form-control-sm"
                 type="text"
                 name="location"
                 placeholder="Search by location"
                 value="{{ request.GET.location }}"
                 autocomplete="off"
                 spellcheck="false">
        </div>
        <div class="col-md-2">
          <select class="form-select form-select-sm" name="bedrooms">
            {% for val, label in bedroom_choices %}
              <option value="{{ val }}" {% if request.GET.bedrooms == val %}selected{% elif not request.GET.bedrooms and val == 'Single Room' %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-2">
          <input class="form-control form-control-sm" type="number" name="price" placeholder="Price (KES)" min="0" value="{{ request.GET.price }}">
        </div>
      </div>

      <!-- Row 2: Price Pills -->
      <div class="mb-3">
        <small class="text-muted me-3">Filter by budget:</small>
        <span class="price-pill" data-val="1-5k">KES 1 – 5 k</span>
        <span class="price-pill" data-val="5-10k">KES 5 – 10 k</span>
        <span class="price-pill" data-val="10-20k">KES 10 – 20 k</span>
        <span class="price-pill" data-val="20k+">KES 20 k+</span>
      </div>

      <!-- Row 3: Bedroom Chips -->
      <div class="mb-4">
        <small class="text-muted me-3">Preferred bedrooms:</small>
        {% for val, label in bedroom_choices %}
          <span class="chip" data-bed="{{ val }}">{{ label }}</span>
        {% endfor %}
      </div>

      <!-- Row 4: Full-width Search Button -->
      <div class="d-flex justify-content-center">
        <button class="btn btn-accent px-5" style="width: 50%; max-width: 600px;">Search</button>
      </div>
    </form>

    <!-- Separator Title -->
    <h4 class="fw-600 mt-5 mb-4">Available Rentals</h4>
  </div>
</section>

<!-- Auto-scroll to results after Search -->
<script>
function scrollToResults() {
  setTimeout(() => {
    document.querySelector('.results-scroll').scrollIntoView({ behavior: 'smooth', block: 'start' });
  }, 150);
}
</script>
{% endif %}

<!-- RESULTS (always shown) -->
<section class="results-scroll py-5">
  <div class="container">
    <div class="row g-4">
      {% for prop in properties %}
        <div class="col-md-4">
          <div class="card h-100 shadow-sm">
            {% if prop.images.first %}
              <img src="{{ prop.images.first.image.url }}" class="card-img-top" alt="{{ prop.title }}">
            {% else %}
              <div class="bg-light text-center py-5 text-muted">No Image</div>
            {% endif %}
            <div class="card-body">
              <h6 class="card-title fw-600">{{ prop.title }}</h6>
              <p class="card-text text-muted small mb-2">
                {{ prop.location }} • KES {{ prop.price }} • {{ prop.bedrooms }}
              </p>
              <a href="{% url 'property_detail' prop.id %}" class="btn btn-sm btn-accent">View Details</a>
            </div>
          </div>
        </div>
      {% empty %}
        <div class="col-12 text-center py-5">
          <p class="text-muted">No properties match your filters — scroll for more or adjust search.</p>
        </div>
      {% endfor %}
    </div>
  </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
/* sync pills/chips with form fields */
document.querySelectorAll('.price-pill').forEach(p => {
  p.addEventListener('click', () => {
    document.querySelector('input[name="price"]').value = '';
    document.querySelector('select[name="price_range"]').value = p.dataset.val;
    p.form.submit();
  });
});
document.querySelectorAll('.chip').forEach(c => {
  c.addEventListener('click', () => {
    document.querySelector('select[name="bedrooms"]').value = c.dataset.bed;
    c.form.submit();
  });
});
</script>
<script>
/* Nominatim autosuggest – throttled, styled */
const locationInput = document.getElementById('location-input');
const suggestBox = document.createElement('div');
suggestBox.className = 'position-absolute w-100 mt-1';
suggestBox.style.zIndex = '1050';
suggestBox.style.maxHeight = '200px';
suggestBox.style.overflowY = 'auto';
suggestBox.style.border = '1px solid #e5e5e5';
suggestBox.style.borderRadius = '8px';
suggestBox.style.background = '#fff';
locationInput.parentElement.style.position = 'relative';
locationInput.parentElement.appendChild(suggestBox);

let lastQuery = '';
let lastCall = 0;
const throttle = 1000; // 1 second

locationInput.addEventListener('input', async () => {
  const query = locationInput.value.trim();
  if (query.length < 2) { suggestBox.innerHTML = ''; return; }
  if (query === lastQuery) return;
  lastQuery = query;

  const now = Date.now();
  if (now - lastCall < throttle) return;
  lastCall = now;

  suggestBox.innerHTML = ''; // clear old

  try {
    const url = `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(query)}&format=json&countrycodes=ke&limit=5`;
    const res = await fetch(url);
    const data = await res.json();
    data.forEach(item => {
      const choice = document.createElement('button');
      choice.type = 'button';
      choice.className = 'list-group-item list-group-item-action border-0 py-2';
      choice.style.textAlign = 'left';
      choice.textContent = item.display_name;
      choice.addEventListener('click', () => {
        locationInput.value = item.display_name;
        suggestBox.innerHTML = '';
      });
      suggestBox.appendChild(choice);
    });
  } catch (e) {
    console.warn('Nominatim error', e);
  }
});

document.addEventListener('click', e => {
  if (!suggestBox.contains(e.target) && e.target !== locationInput) suggestBox.innerHTML = '';
});
</script>
</body>
</html>